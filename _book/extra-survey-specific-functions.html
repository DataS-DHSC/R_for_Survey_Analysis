<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 16 Extra: Survey specific functions | Intermediate R - R for Survey Analysis</title>
  <meta name="description" content="Course notes for the Intermediate R course run internally at DHSC." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 16 Extra: Survey specific functions | Intermediate R - R for Survey Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Course notes for the Intermediate R course run internally at DHSC." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 16 Extra: Survey specific functions | Intermediate R - R for Survey Analysis" />
  
  <meta name="twitter:description" content="Course notes for the Intermediate R course run internally at DHSC." />
  

<meta name="author" content="DHSC Analysts" />


<meta name="date" content="2021-04-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="homework-questions.html"/>

<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Index</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#aims"><i class="fa fa-check"></i><b>2.1</b> Aims</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introduction.html"><a href="introduction.html#day-1"><i class="fa fa-check"></i><b>2.1.1</b> Day 1</a></li>
<li class="chapter" data-level="2.1.2" data-path="introduction.html"><a href="introduction.html#day-2"><i class="fa fa-check"></i><b>2.1.2</b> Day 2</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>2.2</b> Why R</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="day-1-1.html"><a href="day-1-1.html"><i class="fa fa-check"></i><b>3</b> Day 1</a>
<ul>
<li class="chapter" data-level="3.1" data-path="day-1-1.html"><a href="day-1-1.html#outline-for-day-1"><i class="fa fa-check"></i><b>3.1</b> Outline for Day 1</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="loading-survey-data.html"><a href="loading-survey-data.html"><i class="fa fa-check"></i><b>4</b> Loading Survey Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="loading-survey-data.html"><a href="loading-survey-data.html#analysing-a-survey-in-r"><i class="fa fa-check"></i><b>4.1</b> Analysing a survey in R</a></li>
<li class="chapter" data-level="4.2" data-path="loading-survey-data.html"><a href="loading-survey-data.html#loading-the-data"><i class="fa fa-check"></i><b>4.2</b> Loading the data</a></li>
<li class="chapter" data-level="4.3" data-path="loading-survey-data.html"><a href="loading-survey-data.html#cleaning-the-data"><i class="fa fa-check"></i><b>4.3</b> Cleaning the data</a></li>
<li class="chapter" data-level="4.4" data-path="loading-survey-data.html"><a href="loading-survey-data.html#exploring-the-data"><i class="fa fa-check"></i><b>4.4</b> Exploring the data</a></li>
<li class="chapter" data-level="4.5" data-path="loading-survey-data.html"><a href="loading-survey-data.html#applying-survey-weighting-for-exploratory-stats"><i class="fa fa-check"></i><b>4.5</b> Applying survey weighting for exploratory stats</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="crosstabs.html"><a href="crosstabs.html"><i class="fa fa-check"></i><b>5</b> Crosstabs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="crosstabs.html"><a href="crosstabs.html#case-1-with-survey-weights"><i class="fa fa-check"></i><b>5.1</b> Case 1: with survey weights</a></li>
<li class="chapter" data-level="5.2" data-path="crosstabs.html"><a href="crosstabs.html#case-2-without-survey-weights"><i class="fa fa-check"></i><b>5.2</b> Case 2: Without survey weights</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="loading-survey-data-1.html"><a href="loading-survey-data-1.html"><i class="fa fa-check"></i><b>6</b> Loading Survey Data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="loading-survey-data-1.html"><a href="loading-survey-data-1.html#analysing-a-survey-in-r-1"><i class="fa fa-check"></i><b>6.1</b> Analysing a survey in R</a></li>
<li class="chapter" data-level="6.2" data-path="loading-survey-data-1.html"><a href="loading-survey-data-1.html#loading-the-data-1"><i class="fa fa-check"></i><b>6.2</b> Loading the data</a></li>
<li class="chapter" data-level="6.3" data-path="loading-survey-data-1.html"><a href="loading-survey-data-1.html#cleaning-the-data-1"><i class="fa fa-check"></i><b>6.3</b> Cleaning the data</a></li>
<li class="chapter" data-level="6.4" data-path="loading-survey-data-1.html"><a href="loading-survey-data-1.html#exploring-the-data-1"><i class="fa fa-check"></i><b>6.4</b> Exploring the data</a></li>
<li class="chapter" data-level="6.5" data-path="loading-survey-data-1.html"><a href="loading-survey-data-1.html#applying-survey-weighting-for-exploratory-stats-1"><i class="fa fa-check"></i><b>6.5</b> Applying survey weighting for exploratory stats</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="crosstabs-1.html"><a href="crosstabs-1.html"><i class="fa fa-check"></i><b>7</b> Crosstabs</a>
<ul>
<li class="chapter" data-level="7.1" data-path="crosstabs-1.html"><a href="crosstabs-1.html#case-1-with-survey-weights-1"><i class="fa fa-check"></i><b>7.1</b> Case 1: with survey weights</a></li>
<li class="chapter" data-level="7.2" data-path="crosstabs-1.html"><a href="crosstabs-1.html#case-2-without-survey-weights-1"><i class="fa fa-check"></i><b>7.2</b> Case 2: Without survey weights</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="day-2-1.html"><a href="day-2-1.html"><i class="fa fa-check"></i><b>8</b> Day 2</a>
<ul>
<li class="chapter" data-level="8.1" data-path="day-2-1.html"><a href="day-2-1.html#outline-for-day-2"><i class="fa fa-check"></i><b>8.1</b> Outline for Day 2</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="day-2-1.html"><a href="day-2-1.html#take-home-messages-to-start-with"><i class="fa fa-check"></i><b>8.1.1</b> Take home messages to start with</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="loading-packages-and-data.html"><a href="loading-packages-and-data.html"><i class="fa fa-check"></i><b>9</b> Loading packages and data</a></li>
<li class="chapter" data-level="10" data-path="plotting-basic-charts-base-r.html"><a href="plotting-basic-charts-base-r.html"><i class="fa fa-check"></i><b>10</b> Plotting basic charts (base R)</a>
<ul>
<li class="chapter" data-level="10.1" data-path="plotting-basic-charts-base-r.html"><a href="plotting-basic-charts-base-r.html#histograms---basic-frequencies"><i class="fa fa-check"></i><b>10.1</b> histograms - basic frequencies</a></li>
<li class="chapter" data-level="10.2" data-path="plotting-basic-charts-base-r.html"><a href="plotting-basic-charts-base-r.html#bar-charts---plotting-stats-across-categories"><i class="fa fa-check"></i><b>10.2</b> bar charts - plotting stats across categories</a></li>
<li class="chapter" data-level="10.3" data-path="plotting-basic-charts-base-r.html"><a href="plotting-basic-charts-base-r.html#box-plots---plotting-distribution-of-several-categoriesvars"><i class="fa fa-check"></i><b>10.3</b> Box plots - plotting distribution of several categories/vars</a></li>
<li class="chapter" data-level="10.4" data-path="plotting-basic-charts-base-r.html"><a href="plotting-basic-charts-base-r.html#scatter-plots---relationship-between-two-continuous-vars"><i class="fa fa-check"></i><b>10.4</b> Scatter plots - relationship between two continuous vars</a></li>
<li class="chapter" data-level="10.5" data-path="plotting-basic-charts-base-r.html"><a href="plotting-basic-charts-base-r.html#tiny-statistics-excursion"><i class="fa fa-check"></i><b>10.5</b> Tiny statistics excursion</a></li>
<li class="chapter" data-level="10.6" data-path="plotting-basic-charts-base-r.html"><a href="plotting-basic-charts-base-r.html#are-there-any-other-plots-that-you-regularly-use"><i class="fa fa-check"></i><b>10.6</b> Are there any other plots that you regularly use?</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="intermediate-plotting-in-r-ggplot2.html"><a href="intermediate-plotting-in-r-ggplot2.html"><i class="fa fa-check"></i><b>11</b> Intermediate plotting in R (ggplot2)</a>
<ul>
<li class="chapter" data-level="11.1" data-path="intermediate-plotting-in-r-ggplot2.html"><a href="intermediate-plotting-in-r-ggplot2.html#adding-transparency"><i class="fa fa-check"></i><b>11.1</b> Adding transparency</a></li>
<li class="chapter" data-level="11.2" data-path="intermediate-plotting-in-r-ggplot2.html"><a href="intermediate-plotting-in-r-ggplot2.html#adding-automatic-line-of-best-fit"><i class="fa fa-check"></i><b>11.2</b> Adding automatic line of best fit</a></li>
<li class="chapter" data-level="11.3" data-path="intermediate-plotting-in-r-ggplot2.html"><a href="intermediate-plotting-in-r-ggplot2.html#adding-colours"><i class="fa fa-check"></i><b>11.3</b> Adding colours</a></li>
<li class="chapter" data-level="11.4" data-path="intermediate-plotting-in-r-ggplot2.html"><a href="intermediate-plotting-in-r-ggplot2.html#fitting-a-line-of-best-fit-for-each-group-of-a-categorical-variable"><i class="fa fa-check"></i><b>11.4</b> Fitting a line of best fit for each group of a categorical variable</a></li>
<li class="chapter" data-level="11.5" data-path="intermediate-plotting-in-r-ggplot2.html"><a href="intermediate-plotting-in-r-ggplot2.html#exercise-brief-in-class-practice-of-making-charts"><i class="fa fa-check"></i><b>11.5</b> Exercise: Brief in-class practice of making charts</a></li>
<li class="chapter" data-level="11.6" data-path="intermediate-plotting-in-r-ggplot2.html"><a href="intermediate-plotting-in-r-ggplot2.html#ggplot-cheat-sheet"><i class="fa fa-check"></i><b>11.6</b> ggplot cheat sheet</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="regression-model.html"><a href="regression-model.html"><i class="fa fa-check"></i><b>12</b> Regression model</a>
<ul>
<li class="chapter" data-level="12.1" data-path="regression-model.html"><a href="regression-model.html#simple-linear-regression"><i class="fa fa-check"></i><b>12.1</b> Simple linear regression</a></li>
<li class="chapter" data-level="12.2" data-path="regression-model.html"><a href="regression-model.html#multiple-linear-regression"><i class="fa fa-check"></i><b>12.2</b> Multiple linear regression</a></li>
<li class="chapter" data-level="12.3" data-path="regression-model.html"><a href="regression-model.html#lunch-break"><i class="fa fa-check"></i><b>12.3</b> Lunch Break</a></li>
<li class="chapter" data-level="12.4" data-path="regression-model.html"><a href="regression-model.html#ggplot-cheat-sheet-reminder"><i class="fa fa-check"></i><b>12.4</b> ggplot cheat sheet reminder:</a></li>
<li class="chapter" data-level="12.5" data-path="regression-model.html"><a href="regression-model.html#regression-output-inspection-cont."><i class="fa fa-check"></i><b>12.5</b> Regression output inspection (cont.)</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="regression-model.html"><a href="regression-model.html#try-this-for-yourselves"><i class="fa fa-check"></i><b>12.5.1</b> Try this for yourselves</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="testing-regression-assumptions.html"><a href="testing-regression-assumptions.html"><i class="fa fa-check"></i><b>13</b> Testing regression assumptions</a>
<ul>
<li class="chapter" data-level="13.1" data-path="testing-regression-assumptions.html"><a href="testing-regression-assumptions.html#linear-relationship"><i class="fa fa-check"></i><b>13.1</b> Linear relationship</a></li>
<li class="chapter" data-level="13.2" data-path="testing-regression-assumptions.html"><a href="testing-regression-assumptions.html#normality-of-residuals"><i class="fa fa-check"></i><b>13.2</b> normality of residuals</a></li>
<li class="chapter" data-level="13.3" data-path="testing-regression-assumptions.html"><a href="testing-regression-assumptions.html#testing-the-homoscedasticity-assumption"><i class="fa fa-check"></i><b>13.3</b> Testing the Homoscedasticity Assumption</a></li>
<li class="chapter" data-level="13.4" data-path="testing-regression-assumptions.html"><a href="testing-regression-assumptions.html#test-for-autocorrelation-violations-of-independence"><i class="fa fa-check"></i><b>13.4</b> Test for autocorrelation (Violations of independence)</a></li>
<li class="chapter" data-level="13.5" data-path="testing-regression-assumptions.html"><a href="testing-regression-assumptions.html#collinearity"><i class="fa fa-check"></i><b>13.5</b> Collinearity</a></li>
<li class="chapter" data-level="13.6" data-path="testing-regression-assumptions.html"><a href="testing-regression-assumptions.html#multicollinearity"><i class="fa fa-check"></i><b>13.6</b> Multicollinearity</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="significance-tests.html"><a href="significance-tests.html"><i class="fa fa-check"></i><b>14</b> Significance tests</a>
<ul>
<li class="chapter" data-level="14.1" data-path="significance-tests.html"><a href="significance-tests.html#chi-square"><i class="fa fa-check"></i><b>14.1</b> Chi-square</a></li>
<li class="chapter" data-level="14.2" data-path="significance-tests.html"><a href="significance-tests.html#t-test"><i class="fa fa-check"></i><b>14.2</b> T-test</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="homework-questions.html"><a href="homework-questions.html"><i class="fa fa-check"></i><b>15</b> ‘Homework’ questions</a>
<ul>
<li class="chapter" data-level="15.1" data-path="homework-questions.html"><a href="homework-questions.html#training-evaluation"><i class="fa fa-check"></i><b>15.1</b> Training evaluation</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="extra-survey-specific-functions.html"><a href="extra-survey-specific-functions.html"><i class="fa fa-check"></i><b>16</b> Extra: Survey specific functions</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intermediate R - R for Survey Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="extra-survey-specific-functions" class="section level1" number="16">
<h1><span class="header-section-number">Chapter 16</span> Extra: Survey specific functions</h1>
<p>As James showed you yesterday if we are using survey data that comes with weights, we need to account for those.</p>
<p>The ‘survey’ package has adapted functions for the different things that we did today.
Let’s first create the weights for the data at hand, specify the sample design and store it in an R object that we can then call in our tests.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="extra-survey-specific-functions.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add weighting variable</span></span>
<span id="cb110-2"><a href="extra-survey-specific-functions.html#cb110-2" aria-hidden="true" tabindex="-1"></a>nhanes <span class="ot">&lt;-</span> nhanes <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">WTMEC4YR =</span> <span class="fl">0.5</span> <span class="sc">*</span> WTMEC2YR)</span>
<span id="cb110-3"><a href="extra-survey-specific-functions.html#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="extra-survey-specific-functions.html#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create weighted R data object that holds the information about the sampling specifications</span></span>
<span id="cb110-5"><a href="extra-survey-specific-functions.html#cb110-5" aria-hidden="true" tabindex="-1"></a>nhanes_design <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svydesign</span>(<span class="at">data =</span> nhanes, </span>
<span id="cb110-6"><a href="extra-survey-specific-functions.html#cb110-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">strata =</span> <span class="sc">~</span>SDMVSTRA, </span>
<span id="cb110-7"><a href="extra-survey-specific-functions.html#cb110-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">id =</span> <span class="sc">~</span>SDMVPSU, </span>
<span id="cb110-8"><a href="extra-survey-specific-functions.html#cb110-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">nest =</span> <span class="cn">TRUE</span>, </span>
<span id="cb110-9"><a href="extra-survey-specific-functions.html#cb110-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">weights =</span> <span class="sc">~</span>WTMEC4YR)</span></code></pre></div>
<p>Now we can seemlessly work with the weighted data. Let’s create a frequency table that accounts for sample weights.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="extra-survey-specific-functions.html#cb111-1" aria-hidden="true" tabindex="-1"></a>table_gender_smoke_w <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svytable</span>(<span class="sc">~</span>Gender <span class="sc">+</span> SmokeNow, <span class="at">design =</span> nhanes_design) <span class="co"># contains estimated frequencies based on survey weights</span></span>
<span id="cb111-2"><a href="extra-survey-specific-functions.html#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="extra-survey-specific-functions.html#cb111-3" aria-hidden="true" tabindex="-1"></a>table_gender_smoke_w</span></code></pre></div>
<pre><code>##         SmokeNow
## Gender         No      Yes
##   female 24074780 19887290
##   male   29578392 24544477</code></pre>
<p>For reference, there is some sample code for the other main analyses using the survey package.</p>
<div id="survey-weighted-histogram" class="section level4" number="16.0.0.1">
<h4><span class="header-section-number">16.0.0.1</span> Survey-weighted histogram</h4>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="extra-survey-specific-functions.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># BMI</span></span>
<span id="cb113-2"><a href="extra-survey-specific-functions.html#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> nhanes,</span>
<span id="cb113-3"><a href="extra-survey-specific-functions.html#cb113-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(BMI, <span class="at">weight =</span> WTMEC4YR)) <span class="sc">+</span> </span>
<span id="cb113-4"><a href="extra-survey-specific-functions.html#cb113-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">2</span>,</span>
<span id="cb113-5"><a href="extra-survey-specific-functions.html#cb113-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb113-6"><a href="extra-survey-specific-functions.html#cb113-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;BMI&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 2279 rows containing non-finite values (stat_bin).</code></pre>
<p><img src="Intermediate-R---R-for-Survey-Analysis_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
</div>
<div id="survey-weighted-bar-plot" class="section level4" number="16.0.0.2">
<h4><span class="header-section-number">16.0.0.2</span> Survey-weighted bar plot</h4>
<p>Bar plot of SleepHrsNight by gender</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="extra-survey-specific-functions.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the survey-weighted mean by Gender</span></span>
<span id="cb115-2"><a href="extra-survey-specific-functions.html#cb115-2" aria-hidden="true" tabindex="-1"></a>Sleep_mean_gender <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svyby</span>(<span class="at">formula =</span> <span class="sc">~</span>SleepHrsNight, </span>
<span id="cb115-3"><a href="extra-survey-specific-functions.html#cb115-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="sc">~</span>Gender, </span>
<span id="cb115-4"><a href="extra-survey-specific-functions.html#cb115-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">design =</span> nhanes_design, </span>
<span id="cb115-5"><a href="extra-survey-specific-functions.html#cb115-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">FUN =</span> svymean, </span>
<span id="cb115-6"><a href="extra-survey-specific-functions.html#cb115-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">na.rm =</span> <span class="cn">TRUE</span>, </span>
<span id="cb115-7"><a href="extra-survey-specific-functions.html#cb115-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">keep.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb115-8"><a href="extra-survey-specific-functions.html#cb115-8" aria-hidden="true" tabindex="-1"></a>             </span>
<span id="cb115-9"><a href="extra-survey-specific-functions.html#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a bar plot of average SleepHrsNight by gender</span></span>
<span id="cb115-10"><a href="extra-survey-specific-functions.html#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Sleep_mean_gender, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Gender, <span class="at">y =</span> SleepHrsNight)) <span class="sc">+</span></span>
<span id="cb115-11"><a href="extra-survey-specific-functions.html#cb115-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb115-12"><a href="extra-survey-specific-functions.html#cb115-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="st">&quot;Average Hours of Sleep&quot;</span>)</span></code></pre></div>
<p><img src="Intermediate-R---R-for-Survey-Analysis_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
</div>
<div id="survey-weighted-chi2-test" class="section level4" number="16.0.0.3">
<h4><span class="header-section-number">16.0.0.3</span> Survey-weighted Chi2 test</h4>
<p>Next, let’s conduct a Chi2 test with survey weights</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="extra-survey-specific-functions.html#cb116-1" aria-hidden="true" tabindex="-1"></a>survey<span class="sc">::</span><span class="fu">svychisq</span>(<span class="sc">~</span>Gender <span class="sc">+</span> SmokeNow, </span>
<span id="cb116-2"><a href="extra-survey-specific-functions.html#cb116-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">design =</span> nhanes_design,</span>
<span id="cb116-3"><a href="extra-survey-specific-functions.html#cb116-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">statistic =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s X^2: Rao &amp; Scott adjustment
## 
## data:  survey::svychisq(~Gender + SmokeNow, design = nhanes_design,     statistic = &quot;Chisq&quot;)
## X-squared = 0.025482, df = 1, p-value = 0.9573</code></pre>
</div>
<div id="survey-weighted-t-test" class="section level4" number="16.0.0.4">
<h4><span class="header-section-number">16.0.0.4</span> Survey-weighted t-test</h4>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="extra-survey-specific-functions.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># do mean sleeping hours differ between men and women</span></span>
<span id="cb118-2"><a href="extra-survey-specific-functions.html#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svyttest</span>(<span class="at">formula =</span> SleepHrsNight<span class="sc">~</span>Gender,</span>
<span id="cb118-3"><a href="extra-survey-specific-functions.html#cb118-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">design =</span> nhanes_design)</span></code></pre></div>
<pre><code>## Warning in summary.glm(g): observations with zero weight not used for calculating dispersion</code></pre>
<pre><code>## Warning in summary.glm(glm.object): observations with zero weight not used for calculating dispersion</code></pre>
<pre><code>## 
##  Design-based t-test
## 
## data:  SleepHrsNight ~ Gender
## t = -3.4077, df = 32, p-value = 0.001785
## alternative hypothesis: true difference in mean is not equal to 0
## 95 percent confidence interval:
##  -0.15287218 -0.04123256
## sample estimates:
## difference in mean 
##        -0.09705237</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="extra-survey-specific-functions.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s get the mean values printed out (created in step prior to t-test) to aid interpretation of the t-test</span></span>
<span id="cb122-2"><a href="extra-survey-specific-functions.html#cb122-2" aria-hidden="true" tabindex="-1"></a>Sleep_mean_gender</span></code></pre></div>
<pre><code>##   Gender SleepHrsNight         se
## 1 female      6.976103 0.02374684
## 2   male      6.879050 0.01953263</code></pre>
</div>
<div id="survey-weighted-scatter-plot" class="section level4" number="16.0.0.5">
<h4><span class="header-section-number">16.0.0.5</span> Survey-weighted scatter plot</h4>
<p>Let’s look at the relationship between height and weight in 8 year old children.
You can set the transparency parameter alpha to be the sample weight (WTMEC4YR). Observations with a bigger weight will show as darker points.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="extra-survey-specific-functions.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> nhanes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Age <span class="sc">==</span> <span class="dv">8</span>),</span>
<span id="cb124-2"><a href="extra-survey-specific-functions.html#cb124-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Height, <span class="at">y =</span> Weight, <span class="at">alpha =</span> WTMEC4YR)) <span class="sc">+</span> </span>
<span id="cb124-3"><a href="extra-survey-specific-functions.html#cb124-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb124-4"><a href="extra-survey-specific-functions.html#cb124-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">alpha =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 20 rows containing missing values (geom_point).</code></pre>
<p><img src="Intermediate-R---R-for-Survey-Analysis_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
</div>
<div id="survey-weighted-regression" class="section level4" number="16.0.0.6">
<h4><span class="header-section-number">16.0.0.6</span> Survey-weighted regression</h4>
<p>Let’s model Weight based on Height for 8 year olds</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="extra-survey-specific-functions.html#cb126-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(Weight <span class="sc">~</span> Height, <span class="at">data =</span> nhanes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Age <span class="sc">==</span> <span class="dv">8</span>),</span>
<span id="cb126-2"><a href="extra-survey-specific-functions.html#cb126-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">design =</span> nhanes_design)</span>
<span id="cb126-3"><a href="extra-survey-specific-functions.html#cb126-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-4"><a href="extra-survey-specific-functions.html#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code></pre></div>
<pre><code>## 
## Call:
## svyglm(formula = Weight ~ Height, design = nhanes_design, data = nhanes %&gt;% 
##     filter(Age == 8))
## 
## Survey design:
## survey::svydesign(data = nhanes, strata = ~SDMVSTRA, id = ~SDMVPSU, 
##     nest = TRUE, weights = ~WTMEC4YR)
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -92.1619     1.5032  -61.31   &lt;2e-16 ***
## Height        1.0181     0.0101  100.83   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 362.9893)
## 
## Number of Fisher Scoring iterations: 2</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="homework-questions.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
